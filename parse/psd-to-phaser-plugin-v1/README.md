# PSD to Phaser Plugin

PsdToPhaser's plugin is a bunch of convenience functions to get PSD to Phaser's output file up and running in your phaser project more quickly.

## ToDo

- getTexture()
- place: false (also ... support bang bools in generate? !place)
- 

## Usage

### Initializing

You can initialize the plugin via when creating the game's configuration object, like so :

```js
new Phaser.Game({
  // ...
  plugins: {
    global: [
      {
        key: "PsdToJSONPlugin",
        plugin: PsdToJSONPlugin,
        start: true,
        mapping: "P2P", // all examples below assume you're mapping to P2P
        data: { debug: true },
      },
    ],
  },
  // ...
});
```

Note that the optional debug mode is on, which gives you simple visualizations of where all objects are being placed. This can be turned on individually for each item as well.

### Loading

When preloading your scene, use P2P.load() by passing in the folder generated by PSDtoJSON. Any assets in the JSON that do not have a `lazyLoad:true` attribute will start loading. Events are emitted as each asset is loaded.

```js
// Load the JSON
this.P2P.load(this, "psd_key", "assets/simple");

// Listen for asset loading progress
this.events.on("psdLoadProgress", (value) => {
  this.P2PProgress = value;
  this.updateProgress();
});

// Listen for asset loading completion
this.events.once("psdLoadComplete", () => { console.log("All done!")}, this);
```

### Placement

All types have place() and placeAll() methods.

```js
this.myTiles = this.P2P.tiles.placeAll(this, "psd_key");
this.myPoints = this.P2P.points.placeAll(this, "psd_key");
this.myZones = this.P2P.zones.placeAll(this, "psd_key");
// this.mySprites = this.P2P.sprites.placeAll(this, "psd_key");
```

#### Nesting

If you're placing a layer group, all of the descendants will be placed by default.  However, place() also lets you place specific descendants using a slash path format.

```js
// Place a nested group
this.mySprites = this.P2P.sprites.place(
  this,
  "psd_key"
  "nestedSprites/spriteName",
);
```

Finally, if you need to limit the placement recursion, you can pass in a depth parameter.

```js
// Place a nested group
this.mySprites = this.P2P.sprites.place(
  this,
  "psd_key"
  "nestedSprites/spriteName",
);
```

### Removal

Anything placed on the canvas comes with a remove() method. This works a lot like the place() method. It is recursive by default (so if you apply it to a layer group the descendants go away too) but you can pass in a `depth` parameter to limit recursion.

```js
// Place on the canvas
this.doomed = this.P2P.sprites.place(
  this,
  "nestedSprites",
  "psd_key");

// Remove only the immediate children.
this.doomed.remove({depth: 1});

// Remove all descendants.
this.doomed.remove();

```

### Retreival

#### get()

Once you have placed sprites, you can get them using get(). 

```js

// Returns an individual sprite
this.nested = this.P2P.sprites.get(
  "psd_key",
  "nestedSprites/moreNested/aNestedSprite"
);
```
This returns the full nested structure of whatever you've asked for. 


## Sprite Types

In the PSD, each layer can be given a type, which tells the tool what kind of image to create and how it should be represented in the JSON.

### Type : Spritesheets

Generates a basic spritesheet of the child layers. The default behaviour is the place all of the sprites where they show up in the PSD. (Note that naming two layers the same thing will cause one of them to overwrite the other.)

```
demoSpritesheet | spritesheet | 
```

### Type : Atlas

Generates a packed atlas of the child layers. The default behaviour is to place all of the sprites where they show up in the PSD. (Note that naming two layers the same thing will cause one of them to overwrite the other.)

```
demoSpritesheet | atlas | 
```

### Type : Animation

An animation is just a spreadsheet with different trimming rules on the layers that automatically loads as an animation. The layers in an animation group need to be integers, so it knows what frames to put where. If you've done your layer naming properly, though, you should just see an animated sprite when you place the Sprite. 

You can override the default animation properties at several points.

1. Layer naming : In Photoshop, the attributes of the layer name itself can control animation properties. If you pass valid animation parameters, they will be merged in when instantiating the animation.

```
bounce | animation | frameRate: 5, yoyo: true
```

2. Instantiation : When instantiating the sprite, you can also pass in animation parameters, so the same thing could be acheived like so :

```js
// For individual sprites
this.P2P.sprites.place(this, "nested/bounce", "psd_key", {
  animationOptions: {
    frameRate: 5,
    yoyo: true,
  },
});
```

3. Using get() : You can always use get() to retreive the sprite and then use updateAnimation():

```js
this.bounce = this.P2P.sprites.get("psd_key", "nested/bounce");

this.bounce.updateAnimation({
  frameRate: 5,
  yoyo: true,
});
```

### Debugging

The plugin features a top-level debug mode you can feed either a boolean or a configuration object that gives you more granular control : `{ label, shape, console}`. "Label" controls the text label of the layer, "shape" is the visual outline of what is being placed on the canvas and  "console" just gives you some basic info about the placement.

```js

// Turn on all the lights!
plugins: {
    global: [
      {
        key: 'PsdToPhaserPlugin',
        plugin: PsdToPhaserPlugin,
        start: true,
        mapping: "P2P",
        data: true ,
      },
    ],
  }

// Only certain modes on
plugins: {
    global: [
      {
        key: 'PsdToPhaserPlugin',
        plugin: PsdToPhaserPlugin,
        start: true,
        mapping: "P2P",
        data: { debug: {
          shape: true,
          label: false
        } },
      },
    ],
  }
```

When placing objects, you can override whatever your global setting is the same way.

```js
// Turn off the text labels
this.P2P.tiles.place(this, "psd_key", "backgroundTiles", {
  debug: {
    label: false,
  },
});

// The equivelant of not using debug at all.
this.P2P.points.place(this, "psd_key", "pickups/deepNestPoints", {
  debug: {
    shape: false,
    label: false,
    console: false,
  },
});
```

## Development

When developing, run : `npm run watch` to build plugin on save.

To link plugin to your project locally, run `npm link` in this folder, and then `npm link psd-to-json-plugin` in the project you'd like to use it in.

(To reset, just run the same commands with `unlink`.)
