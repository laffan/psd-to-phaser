# PSD to Phaser Plugin

PsdToPhaser's plugin is a bunch of convenience functions to get PSD to Phaser's output file up and running in your phaser project more quickly.

## Usage

### Initializing

You can initialize the plugin via when creating the game's configuration object, like so :

```js
new Phaser.Game({
  // ...
  plugins: {
    global: [
      {
        key: "PsdToJSONPlugin",
        plugin: PsdToJSONPlugin,
        start: true,
        mapping: "P2P", // all examples below assume you're mapping to P2P
        data: { debug: true },
      },
    ],
  },
  // ...
});
```

Note that the optional debug mode is on, which gives you simple visualizations of where all objects are being placed. This can be turned on individually for each item as well.

### Loading

When preloading your scene, use P2P.load() by passing in the folder generated by PSDtoJSON. Any assets in the JSON that do not have a `lazyLoad:true` attribute will start loading. Events are emitted as each asset is loaded.

```js
// Load the JSON
this.P2P.load(this, "simple_psd", "assets/simple");

// Listen for asset loading progress
this.events.on("psdAssetsLoadProgress", (value) => {
  this.P2PProgress = value;
  this.updateProgress();
});

// Listen for asset loading completion
this.events.once("psdAssetsLoadComplete", this.onP2PLoadComplete, this);
```

### Placement

All types have place() and placeAll() methods.

```js
this.myTiles = this.P2P.tiles.placeAll(this, "simple_psd");
this.myPoints = this.P2P.points.placeAll(this, "simple_psd");
this.myZones = this.P2P.zones.placeAll(this, "simple_psd");
// this.mySprites = this.P2P.sprites.placeAll(this, "simple_psd");
```

#### Nesting

Place() also works with nested layer groups, using the slash path format.

```js
// Place a nested group
this.mySprites = this.P2P.sprites.place(
  this,
  "nestedSprites/spriteName",
  "simple_psd"
);
```

#### Individual debug boxes

To get a debug box around the element being placed, use the options object :

```js
this.P2P.sprites.placeAll(this, "simple_psd", { debug: true });
```

#### Placing sprites as Images

Sprites are placed as Phaser Sprites by default, but _can_ be placed as Phaser Images via the options object.

```js
// Create Image instances for all sprites.
this.P2P.sprites.placeAll(this, "simple_psd", { useImage: true });

// For individual sprites
this.P2P.sprites.place(
  this,
  "nestedSprites/moreNested/aNestedSprite",
  "simple_psd",
  { useImage: true }
);
```

## Retreival

#### get()

Once you have placed sprites, you can get them using get(). This works exactly the same way as place.

```js

// Returns an individual sprite
this.nested = this.P2P.sprites.get(
  "simple_psd",
  "nestedSprites/moreNested/aNestedSprite"
);

// Returns an array of all sprites placed
this.allSprites = this.P2P.sprites.getAll(
  "simple_psd"
);

// Returns an array of any sprites placed in top level.
// (If you have placed sprites but they aren't at that level, will return empty array)
this.topLevel = this.P2P.sprites.getAll(
  "simple_psd", { depth: 1}
);

// Return an animation object and apply an update to it.
this.bounce = this.P2P.sprites.get("simple_psd", "nested/bounce");

this.bounce.updateAnimation({
  frameRate: 5,
  yoyo: true,
});
```



#### getTexture()

You can also get the texture of a sprite. This is particularly useful for [spritesheets](#type--spritesheets).

```js
// Retreive texture
const myTexture = this.P2P.sprites.getTexture("simple_psd", "mySpritesheet");

// Use texture in emitter
this.add.particles(100, 100, myTexture, {
  frame: [0], // Use all three frames from the spritesheet
  lifespan: 2000,
  speed: { min: 100, max: 200 },
  angle: { min: 0, max: 360 },
  scale: { start: 1, end: 0 },
  frequency: 100,
  emitting: true,
});
```

## Sprite Types

In PSDtoJSON each layer can be given a type, which tells the tool what kind of image to create and how it should be represented in the JSON.

### Type : Spritesheets

Generates a basic spritesheet of the child layers. The default behaviour is the place all of the sprites where they show up in the PSD. However, if you would like to use the sprites as a resource for something else or just load them without placing them, you can set autoplacement to false in the layer object.

```
demoSpritesheet | spritesheet | autoplacement: false
```

This loads the file, but does not place a sprite when using placeAll or nested placements. You can then retreive the sheet as a texuture using [getTexture](#gettexture).

### Type : Animation

This is all handled automatically, so if you've done your layer naming properly, you should just see an animated sprite when loading the JSON. Animations are just Phaser animations, so all associated functions (play(), pause(), resume() etc) should work as expected.

You can override the default animation properties at several points.

1. Layer naming : In Photoshop, the attributes of the layer name itself can control animation properties. If you pass valid animation parameters, they will be merged in when instantiating the animation.

```
bounce | animation | frameRate: 5, yoyo: true
```

2. Instantiation : When instantiating the sprite, you can also pass in animation parameters, so the same thing could be acheived like so :

```js
// For individual sprites
this.P2P.sprites.place(this, "nested/bounce", "simple_psd", {
  animationOptions: {
    frameRate: 5,
    yoyo: true,
  },
});
```

3. Using get() : You can always use get() to retreive the sprite and then use updateAnimation():

```js
this.bounce = this.P2P.sprites.get("simple_psd", "nested/bounce");

this.bounce.updateAnimation({
  frameRate: 5,
  yoyo: true,
});
```

### Debugging

The plugin features a top-level debug mode you can feed either a `true|false` or a configuration object that gives you more granular control : `{ label, shape, console}`. They control the text label of the layer, the visual outline of what is being placed on the canvas and some console output about the placement.

```js

// Turn on all the lights!
plugins: {
    global: [
      {
        key: 'PsdToPhaserPlugin',
        plugin: PsdToPhaserPlugin,
        start: true,
        mapping: "P2P",
        data: true ,
      },
    ],
  }

// Only certain modes on
plugins: {
    global: [
      {
        key: 'PsdToPhaserPlugin',
        plugin: PsdToPhaserPlugin,
        start: true,
        mapping: "P2P",
        data: { debug: {
          shape: true,
          label: false
        } },
      },
    ],
  }
```

When placing objects, you can override whatever your global setting is the same way.

```js
// Turn off the text labels
this.P2P.tiles.place(this, "simple_psd", "backgroundTiles", {
  debug: {
    label: false,
  },
});

// The equivelant of not using debug at all.
this.P2P.points.place(this, "simple_psd", "pickups/deepNestPoints", {
  debug: {
    shape: false,
    label: false,
    console: false,
  },
});
```

## Development

When developing, run : `npm run watch` to build plugin on save.

To link plugin to your project locally, run `npm link` in this folder, and then `npm link psd-to-json-plugin` in the project you'd like to use it in.

(To reset, just run the same commands with `unlink`.)
