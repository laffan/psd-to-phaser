# PSD to JSON Phaser Plugin

PsdToJSON's phaser plugin is a bunch of convenience functions to get PSD to JSON up and running in your phaser project more quickly.

## ToDo

- [x] placeAll()
- [x] Access loaded/nested content. (Move stuff, add physics, setPos, etc)
- [x] Animations
- [x] Spritesheets
- [ðŸ‘‰] Atlas
- [ ] Instances (loop back around to generate first and get this working)

      The functionality could be super simple : if the folder has "instanced: true", there 
      has to be a layer with rootInstance: layerName . (If it isn't there, error aborts export.)

      Then it just exports that layer like normal (could be any time), and to the folder 
      attaches an "instances" object that looks  like so : 

      instances : [{
        name : layerName,
        instances: [{
          x: 0,
          y: 0,
          attributes: {
            ...
          }
        }]
      }]

      Which causes place and placeAll to loop through and treat them like new sprites, 
      just with an instanceID attached. (ie. layerName_01) 

- [ ] Root x/y (+ placing multiple psds in a single scene)
- [ ] Light reactor. Split apart modules into smaller files

## Usage

### Initializing

You can initialize the plugin via when creating the game's configuration object, like so :

```js
new Phaser.Game({
  // ...
  plugins: {
    global: [
      {
        key: "PsdToJSONPlugin",
        plugin: PsdToJSONPlugin,
        start: true,
        mapping: "P2J", // all examples below assume you're mapping to P2J
        data: { debug: true },
      },
    ],
  },
  // ...
});
```

Note that the optional debug mode is on, which gives you simple visualizations of where all objects are being placed. This can be turned on individually for each item as well.

### Loading

When preloading your scene, use P2J.load() by passing in the folder generated by PSDtoJSON. Any assets in the JSON that do not have a `lazyLoad:true` attribute will start loading.  Events are emitted as each asset is loaded.

```js
// Load the JSON
this.P2J.load(this, "simple_psd", "assets/simple");

// Listen for asset loading progress
this.events.on("psdAssetsLoadProgress", (value) => {
  this.p2jProgress = value;
  this.updateProgress();
});

// Listen for asset loading completion
this.events.once("psdAssetsLoadComplete", this.onP2JLoadComplete, this);
```

### Placement

All types have place() and placeAll() methods. 

```js
this.myTiles = this.P2J.tiles.placeAll(this, "simple_psd");
this.myPoints = this.P2J.points.placeAll(this, "simple_psd");
this.myZones = this.P2J.zones.placeAll(this, "simple_psd");
// this.mySprites = this.P2J.sprites.placeAll(this, "simple_psd");
```

#### Nesting

Place() also works with nested layer groups, using the slash path format.

```js
// Place a nested group
this.mySprites = this.P2J.sprites.place(
  this,
  "nestedSprites/spriteName",
  "simple_psd"
);
```

#### Individual debug boxes
To get a debug box around the element being placed, use the options object :

```js
this.P2J.sprites.placeAll(this, "simple_psd", { debug: true });
```

#### Placing sprites as Images

Sprites are placed as Phaser Sprites by default, but _can_ be placed as Phaser Images via the options object.

```js
// Create Image instances for all sprites.
this.P2J.sprites.placeAll(this, "simple_psd", { useImage: true });

// For individual sprites
this.P2J.sprites.place(
  this,
  "nestedSprites/moreNested/aNestedSprite",
  "simple_psd",
  { useImage: true }
);
```


## Retreival

#### get()

All types have a get() method, which you can use to retreive any object, regardless of its nested depth.

```js
// Load all sprites
this.mySprites = this.P2J.sprites.placeAll(this, "simple_psd");

// Retreive an individual sprite
this.nest = this.P2J.sprites.get(
  "simple_psd",
  "nestedSprites/moreNested/aNestedSprite"
);
```

#### getTexture()

You can also get the texture of a sprite.  This is particularly useful for [spritesheets](#type--spritesheets).

```js
// Load the spritesheet
this.P2J.sprites.place(this, "mySpriteSheet", "simple_psd");

// Retreive texture
const myTexture = this.P2J.sprites.getTexture("simple_psd", "mySpritesheet");

// Use texture in emitter
this.add.particles(100, 100, myTexture, {
  frame: [0], // Use all three frames from the spritesheet
  lifespan: 2000,
  speed: { min: 100, max: 200 },
  angle: { min: 0, max: 360 },
  scale: { start: 1, end: 0 },
  frequency: 100,
  emitting: true,
});
```


## Sprite Types

In PSDtoJSON each layer can be given a type, which tells the tool what kind of image to create and how it should be represented in the JSON. 

### Type : Spritesheets

Generates a basic spritesheet of the child layers. The default behaviour is the place all of the sprites where they show up in the PSD. However, if you would like to use the sprites as a resource for something else or just load them without placing them, you can set autoplacement to false in the layer object.

```
demoSpritesheet | spritesheet | autoplacement: false
```

This loads the file, but does not place a sprite when using placeAll or nested placements.  You can then retreive the sheet as a texuture using [getTexture](#gettexture).

###  Type : Animation

This is all handled automatically, so if you've done your layer naming properly, you should just see an animated sprite when loading the JSON. Animations are just Phaser animations, so all associated functions (play(), pause(), resume() etc) should work as expected.

You can override the default animation properties at several points.

1. Layer naming : In Photoshop, the attributes of the layer name itself can control animation properties. If you pass valid animation parameters, they will be merged in when instantiating the animation.

```
bounce | animation | frameRate: 5, yoyo: true
```

2. Instantiation : When instantiating the sprite, you can also pass in animation parameters, so the same thing could be acheived like so :

```js
// For individual sprites
this.P2J.sprites.place(this, "nested/bounce", "simple_psd", {
  animationOptions: {
    frameRate: 5,
    yoyo: true,
  },
});
```

3. Using get() : You can always use get() to retreive the sprite and then use updateAnimation():

```js
this.bounce = this.P2J.sprites.get("simple_psd", "nested/bounce");

this.bounce.updateAnimation({
  frameRate: 5,
  yoyo: true,
});
```


## Development

When developing, run : `npm run watch` to build plugin on save.

To link plugin to your project locally, run `npm link` in this folder, and then `npm link psd-to-json-plugin` in the project you'd like to use it in.

(To reset, just run the same commands with `unlink`.)
